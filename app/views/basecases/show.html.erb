<% # update the lookup table on page reload 

     
    # if there is already a lookup table then is is updated

    if @basecase.lookups.count > 0  

        params[:lookup] = {
     
            name: @basecase.parse_code(@rules.last.name, @basecase.id),
            basecase_id: @basecase.id
           }

        @lookup = Lookup.find(:last, :conditions => [" basecase_id = ?", @basecase.id]) 
            if @lookup.update_attributes(params[:lookup])
                flash[:success] = "Data updated"
            else
                flash[:success] = "The data didn't update this time"
            end   

    # if there isn't a lookup table it is created
    
    else 

        params[:lookup] = {
     
            name: @basecase.lookup_table(@basecase.id),
            basecase_id: @basecase.id
           }

        @lookup = @basecase.lookups.build(params[:lookup]) 
            if @lookup.save  
                flash[:success] = "You have created new data" 
            else 
                flash[:success] = "It didn't work mate" 
            end 

    end

%>

<% @lookup = Lookup.find(:last, :conditions => [" basecase_id = ?", @basecase.id])  %>
<%= @lookup.name %>
<br/>

<h2>Financials</h2>

<h1>Upload input data</h1>

<%= form_tag({:controller => 'static_pages', :action => :uploadfile}, :multipart => true) do %>
  <%= file_field_tag 'upload[datafile]' %>
  <%= submit_tag("Upload") %> 
<% end %>


<%= @basecase.parse_code(@rules.last.name, @basecase.id)
%><br/>


<%  if @basecase.rules.count < 1 %>
  <%= render 'shared/rule_form' %>
<%  else %>
  <div class="row">
    <div class="span12">

     <% @rules.each do |rule| %>
      <%= form_for rule do |f| %>
        <%= render 'shared/error_messages', :object => f.object %>

        <%= f.text_area :name %>

        <%= f.submit "Update", :class => "btn"  %>
      <% end %>
    <% end %>
    </div>
  </div>
<% end %>

<%= render 'shared/annual_form' %>


<h4>Current annual data</h4>
<br/>
     <% @annuals.each do |annual| %>
         <%= form_for annual do |f| %>
           <%= render 'shared/error_messages', :object => f.object %>

           <%= f.text_field :name, :class=> "input-small", :placeholder=>"Line item", :value=> annual.name %>

           <%= f.text_field :year_0, :class=> "input-small", :placeholder=>"year 0", :value=> annual.year_0 %>

           <%= f.text_field :year_1, :class=> "input-small", :placeholder=>"year 1", :value=> annual.year_1 %>

           <%= f.text_field :year_2, :class=> "input-small", :placeholder=>"year 2", :value=> annual.year_2 %>

           <%= f.text_field :year_3, :class=> "input-small", :placeholder=>"year 3", :value=> annual.year_3 %>

           <%= f.text_field :year_4, :class=> "input-small", :placeholder=>"year 4", :value=> annual.year_4 %>

           <%= f.text_field :year_5, :class=> "input-small", :placeholder=>"year 5", :value=> annual.year_5 %>

           <%= f.submit "Update" %> 
             
           <%= link_to "delete", annual,   :method => :delete,
                                           :confirm => "You sure?" %>

           <% @annual_item = Annual.where("id = ?", annual.id) %>
           <% @annual_item.each do |annual_item|%>
             <%=link_to "edit fx", annual_item %>       
           <% end %> 

         <% end %>
       <% end %>


<h2>Debt portfolio</h2>

<%= render 'shared/borrowing_form' %>

<h4>Current debt portfolio</h4>

     <% @borrowings.each do |borrowing| %>
         <%= form_for borrowing do |f| %>
           <%= render 'shared/error_messages', :object => f.object %>

           <%= f.text_field :size, :class=> "input-small", :placeholder=>"size", :value => borrowing.size %>

           <%= f.text_field :coupon, :class=> "input-small", :placeholder=>"coupon", :value => borrowing.coupon %>

           <%= f.text_field :issue_year, :class=> "input-small", :placeholder=>"issue_year", :value => borrowing.issue_year %>

           <%= f.text_field :maturity_year, :class=> "input-small", :placeholder=>"maturity_year", :value => borrowing.maturity_year %>

           <%= f.text_field :currency, :class=> "input-small", :placeholder=>"currency", :value => borrowing.currency %>

           <%= f.text_field :fixed_float, :class=> "input-small", :placeholder=>"fixed/float", :value => borrowing.fixed_float %>

           <%= f.submit "Update" %>

         <% end %>
     <% end %>

<br/><br/><hr><br/>

